C51 COMPILER V9.56.0.0   MAIN                                                              08/04/2020 11:16:59 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\hex\main.obj
COMPILER INVOKED BY: F:\Keil\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(9,SIZE) BROWSE DEBUG PRINT(.\lst\main.lst) TABS(2) OBJ
                    -ECT(.\hex\main.obj)

line level    source

   1          #ifndef _MAIN_C_
   2          #define _MAIN_C_
   3          /*********************************************************************************************************
             -************/
   4          #include "ca51f_config.h"
   5          #include "includes\ca51f3sfr.h"
   6          #include "includes\ca51f3xsfr.h"
   7          #include "includes\gpiodef_f3.h"
   8          #include <stdio.h>
   9          
  10          #include "Library\includes\delay.h"
  11          #include "Library\includes\uart.h"
  12          #include "Library\includes\system_clock.h"
  13          #include "Library\Includes\rtc.h" 
  14          #include "Library\Includes\pwm.h" 
  15          #include "includes\system.h"
  16          #include "Library\includes\adc.h"
  17          #include "Library\includes\wdt.h"
  18          /*********************************************************************************************************
             -************/
  19          #include "TS_Lib\Includes\ts_configuration.h"
  20          #include "TS_Lib\Includes\ts_def.h"
  21          #include "TS_Lib\Includes\ts_api.h"
  22          #include "TS_Lib\Includes\ts_service.h"
  23          /*********************************************************************************************************
             -************/  
  24          /********************************************************************************************************
  25          ËµÃ÷£º
  26          ----------------------------------------------------------------------------------------------------------
             ---
  27          1.ts_configuration.hÊÇ´¥ÃþµÄÅäÖÃÎÄ¼þ£¬¿ÉÔÚÅäÖÃÎÄ¼þÖÐÉèÖÃ´¥ÃþÍ¨µÀ¡¢ÁéÃô¶ÈµÈ¡£Ïê¼ûts_configuration.hÖÐµÄËµÃ÷
             -¡£
  28          ----------------------------------------------------------------------------------------------------------
             ---
  29          2.Èç¹ûÐèÒªÊ¹ÓÃUARTÀ´µ÷ÊÔ£¬¿ÉÔÚca51f5_config.hÖÐ´ò¿ªºê¶¨ÒåUART0_EN
  30          ----------------------------------------------------------------------------------------------------------
             ---
  31          3.´¥Ãþ¿â¶ÔÍâµÄÊý¾Ý½Ó¿ÚÎªKeysFlagSN£¬ÓÃ»§¿É¸ù¾ÝKeysFlagSNµÄÖµÀ´ÅÐ¶Ï´¥Ãþ¼üÊÇ·ñ°´ÏÂ£¨Èç¹û´¥Ãþ¼ü°´ÏÂ£¬KeysFlag
             -SN
  32          µÄ¶ÔÓ¦Î»Ò»Ö±Îª1£¬´¥Ãþ¼üËÉ¿ª£¬¶ÔÓ¦Î»±äÎª0£©£¬TS_KeyÊÇ¸ù¾ÝKeysFlagSNµÄÖµÉú³ÉµÄ°´¼üÏûÏ¢£¬ÓÃ»§Èç²»Ê¹ÓÃ¿ÉºöÂÔ¡£
  33          ----------------------------------------------------------------------------------------------------------
             ---
  34          4.Ê¹ÄÜÁË´¥ÃþÊ¡µçÄ£Ê½ºó£¬ÔÚÎÞ°´¼üÊ±£¬ÔÚ¶¨ÒåµÄÊ±¼äºó»á½øÈëÊ¡µçÄ£Ê½£¬½øÈëÊ¡µçÄ£Ê½Ç°»á¹Ø±ÕTMCÖÐ¶ÏºÍ´¥ÃþÖÐ¶Ï£¨×
             -¢Òâ£¬×Ü
  35          ÖÐ¶ÏÈÔÊÇ¿ªÆôµÄ£©£¬ÔÚ´¥ÃþÊ¡µçÄ£Ê½ÏÂ£¬CPU»á½øÈëSTOPÄ£Ê½£¬ÔÚ±»´¥Ãþ»½ÐÑºó£¬³ÌÐòÔÚÊ¡µçº¯Êý£¨TS_EnterSleepMode£©
             -µÄÑ­»·ÄÚÔËÐÐ£¨×¢Òâ£¬´¥ÃþÊ¡µçÄ£Ê½³ÌÐò²»
  36          »áÔÚÖ÷Ñ­»·ÄÚÔËÐÐ£©£¬ÔÚ´¥ÃþÊ¡µçÄ£Ê½ÏÂÈç¹û»¹ÒªÏìÓ¦ÆäËûÖÐ¶Ï£¬ÓÃ»§ÐèÔÚ½øÈë´¥ÃþÊ¡µçÄ£Ê½Ç°×ÔÐÐ¿ªÆôÆäËûÖÐ¶Ï£¬
  37          Èç¹ûÐèÒªÍË³öÊ¡µçÄ£Ê½£¬ÓÃ»§Ö»ÐèÒªÔÚÊ¡µçº¯ÊýÑ­»·ÄÚ¼ÓÈëÌõ¼þÅÐ¶Ï£¬Ìø³öÑ­»·¼´¿É¡£
  38          
  39          ±äÁ¿TS_SleepEnÊÇ¿ØÖÆ´¥ÃþÊ¡µçÄ£Ê½µÄ¿ª¹Ø£¬Èç¹ûÏ£Íû³ÌÐòÔÚÄ³Ð©Ìõ¼þÏÂ²»½øÈëÊ¡µçÄ£Ê½£¬Ö»ÐèÔÚ´ËÌõ¼þÏÂÉèÖÃTS_Sleep
             -En = 0£»
  40          
  41          
  42          ----------------------------------------------------------------------------------------------------------
C51 COMPILER V9.56.0.0   MAIN                                                              08/04/2020 11:16:59 PAGE 2   

             ---
  43          5.´¥ÃþÍâ¹ÒµçÈÝ(¼´TK_CAPÒý½ÅÁ¬½ÓµçÈÝ)·¶Î§£º6nF~50nF,½¨ÒéÖµ£º20nF£¨¼´203£©
  44          ----------------------------------------------------------------------------------------------------------
             ---
  45          6.´¥ÃþÒý½Å´®Áªµç×è·¶Î§£º0~5K£¬½¨ÒéÖµ£º1KÅ·Ä·£¬Èç¹ûÓÐ¿¹¶Ô½²»úµÈµç´Å¸ÉÈÅÒªÇó£¬ ´Ëµç×èÖÁÉÙ3KÒÔÉÏ¡£
  46          ********************************************************************************************************/
  47          unsigned char read_inner_trim(void)       
  48          {
  49   1        unsigned char value;
  50   1        FSCMD = 0x80; 
  51   1        PTSH = 0x00;        
  52   1        PTSL = 0x24;      
  53   1        FSCMD = 0x81;           
  54   1        value = FSDAT;
  55   1        FSCMD = 0;
  56   1        return value;
  57   1      }
  58          void SystemInit(void)
  59          {
  60   1      #ifdef LVD_RST_ENABLE
  61   1        LVDCON = 0xc1;  //ÉèÖÃLVD¸´Î»µçÑ¹Îª2V
  62   1      #endif
  63   1      #if (SYSCLK_SRC == PLL)
  64   1        Sys_Clk_Set_PLL(PLL_Multiple);  
  65   1      #endif
  66   1      #ifdef UART0_EN
                Uart0_Initial(UART0_BAUTRATE);
              #endif
  69   1      #ifdef UART1_EN
                Uart1_Initial(UART1_BAUTRATE);
              #endif
  72   1      
  73   1      #if (RTC_CLK_SELECT == IRCL)
  74   1      //¿´ÃÅ¹·Ê±ÖÓÔ´ÎªIRCL
  75   1        CKCON |= ILCKE;                                 //Ê¹ÄÜIRCL
  76   1        WDCON  = WDTS(WDTS_IRCL) | WDRE(WDRE_reset);    //ÉèÖÃ¿´ÃÅ¹·Ê±ÖÓÔ´ÎªILCKE£¬Ä£Ê½Îª¸´Î»Ä£Ê½
  77   1      #elif (RTC_CLK_SELECT == XOSCL) 
                CKCON |= XLCKE;
                while(!(CKCON & XLSTA));
                WDCON  = WDTS(WDTS_XOSCL) | WDRE(WDRE_reset);   //ÉèÖÃ¿´ÃÅ¹·Ê±ÖÓÔ´ÎªXOSCL£¬Ä£Ê½Îª¸´Î»Ä£Ê½
              #endif
  82   1        WDVTHH = 0;                                     //¿´ÃÅ¹·¸´Î»ãÐÖµ¸ß°ËÎ»ÉèÖÃ µ±Ç°ÖµÎª5s 
  83   1        WDVTHL = 75;                                    //¿´ÃÅ¹·¸´Î»ãÐÖµµÍ°ËÎ»ÉèÖÃ
  84   1        WDFLG = 0xA5; 
  85   1        
  86   1        
  87   1        ADCFGH = (ADCFGH&0xC0) | VTRIM(read_inner_trim());  //¼ÓÔØADCÄÚ²¿»ù×¼Ð£×¼Öµ
  88   1      }
  89          void main(void)
  90          {
  91   1        SystemInit();
  92   1      
  93   1        EA = 1;
  94   1      
  95   1        //printf("start\n\r");
  96   1        TS_init();  
  97   1        
  98   1      
  99   1        while(1)
 100   1        {   
 101   2          
 102   2          TS_Action();
C51 COMPILER V9.56.0.0   MAIN                                                              08/04/2020 11:16:59 PAGE 3   

 103   2      
 104   2          if(KeysFlagSN != 0)
 105   2          {
 106   3            //printf("KeysFlagSN:%X\n\r",KeysFlagSN);
 107   3          }
 108   2          if(TS_Key != 0)
 109   2          {
 110   3            //printf("TS_Key:%X\n\r",TS_Key);
 111   3            switch(TS_Key)
 112   3            {
 113   4              
 114   4              //µ¥°´¼üÏûÏ¢
 115   4              case K1:                  //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢      
 116   4                
 117   4              break;
 118   4              case (K1|KEY_BREAK):      //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 119   4                break;
 120   4              case (K1|KEY_LONG_START): //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 121   4                break;
 122   4              case (K1|KEY_LONG):       //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 123   4                break;
 124   4              case (K1|KEY_LONG_BREAK): //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 125   4                break;
 126   4      
 127   4            }
 128   3          }
 129   2      
 130   2        }
 131   1      
 132   1      }
 133          #endif
 134          
 135          
 136          
 137          
 138          
 139          
 140          
 141          
 142          
 143          
 144          
 145          
 146          
 147          
 148          
 149          
 150          
 151          
 152          
 153          
 154          
 155          
 156          
 157          
 158          
 159          
 160          
 161          
 162          
 163          
 164          
C51 COMPILER V9.56.0.0   MAIN                                                              08/04/2020 11:16:59 PAGE 4   

 165          
 166          
 167          
 168          
 169          
 170          
 171          
 172          
 173          
 174          
 175          
 176          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     83    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
