C51 COMPILER V9.56.0.0   MAIN                                                              08/03/2020 17:20:28 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\hex\main.obj
COMPILER INVOKED BY: F:\Keil\C51\BIN\C51.exe main.c OMF2 OPTIMIZE(9,SIZE) BROWSE DEBUG PRINT(.\lst\main.lst) TABS(2) OBJ
                    -ECT(.\hex\main.obj)

line level    source

   1          #ifndef _MAIN_C_
   2          #define _MAIN_C_
   3          /*********************************************************************************************************
             -************/
   4          #include "ca51f_config.h"
   5          #include "includes\ca51f3sfr.h"
   6          #include "includes\ca51f3xsfr.h"
   7          #include "includes\gpiodef_f3.h"
   8          
   9          #include "Library\includes\delay.h"
  10          #include "Library\includes\uart.h"
  11          #include "Library\includes\system_clock.h"
  12          #include "Library\Includes\rtc.h" 
  13          #include "Library\Includes\pwm.h" 
  14          #include "includes\system.h"
  15          #include "Library\includes\adc.h"
  16          #include "Library\includes\wdt.h"
  17          /*********************************************************************************************************
             -************/
  18          #include "TS_Lib\Includes\ts_configuration.h"
  19          #include "TS_Lib\Includes\ts_def.h"
  20          #include "TS_Lib\Includes\ts_api.h"
  21          #include "TS_Lib\Includes\ts_service.h"
  22          /*********************************************************************************************************
             -************/  
  23          /********************************************************************************************************
  24          ËµÃ÷£º
  25          ----------------------------------------------------------------------------------------------------------
             ---
  26          1.ts_configuration.hÊÇ´¥ÃþµÄÅäÖÃÎÄ¼þ£¬¿ÉÔÚÅäÖÃÎÄ¼þÖÐÉèÖÃ´¥ÃþÍ¨µÀ¡¢ÁéÃô¶ÈµÈ¡£Ïê¼ûts_configuration.hÖÐµÄËµÃ÷
             -¡£
  27          ----------------------------------------------------------------------------------------------------------
             ---
  28          2.Èç¹ûÐèÒªÊ¹ÓÃUARTÀ´µ÷ÊÔ£¬¿ÉÔÚca51f5_config.hÖÐ´ò¿ªºê¶¨ÒåUART0_EN
  29          ----------------------------------------------------------------------------------------------------------
             ---
  30          3.´¥Ãþ¿â¶ÔÍâµÄÊý¾Ý½Ó¿ÚÎªKeysFlagSN£¬ÓÃ»§¿É¸ù¾ÝKeysFlagSNµÄÖµÀ´ÅÐ¶Ï´¥Ãþ¼üÊÇ·ñ°´ÏÂ£¨Èç¹û´¥Ãþ¼ü°´ÏÂ£¬KeysFlag
             -SN
  31          µÄ¶ÔÓ¦Î»Ò»Ö±Îª1£¬´¥Ãþ¼üËÉ¿ª£¬¶ÔÓ¦Î»±äÎª0£©£¬TS_KeyÊÇ¸ù¾ÝKeysFlagSNµÄÖµÉú³ÉµÄ°´¼üÏûÏ¢£¬ÓÃ»§Èç²»Ê¹ÓÃ¿ÉºöÂÔ¡£
  32          ----------------------------------------------------------------------------------------------------------
             ---
  33          4.Ê¹ÄÜÁË´¥ÃþÊ¡µçÄ£Ê½ºó£¬ÔÚÎÞ°´¼üÊ±£¬ÔÚ¶¨ÒåµÄÊ±¼äºó»á½øÈëÊ¡µçÄ£Ê½£¬½øÈëÊ¡µçÄ£Ê½Ç°»á¹Ø±ÕTMCÖÐ¶ÏºÍ´¥ÃþÖÐ¶Ï£¨×
             -¢Òâ£¬×Ü
  34          ÖÐ¶ÏÈÔÊÇ¿ªÆôµÄ£©£¬ÔÚ´¥ÃþÊ¡µçÄ£Ê½ÏÂ£¬CPU»á½øÈëSTOPÄ£Ê½£¬ÔÚ±»´¥Ãþ»½ÐÑºó£¬³ÌÐòÔÚÊ¡µçº¯Êý£¨TS_EnterSleepMode£©
             -µÄÑ­»·ÄÚÔËÐÐ£¨×¢Òâ£¬´¥ÃþÊ¡µçÄ£Ê½³ÌÐò²»
  35          »áÔÚÖ÷Ñ­»·ÄÚÔËÐÐ£©£¬ÔÚ´¥ÃþÊ¡µçÄ£Ê½ÏÂÈç¹û»¹ÒªÏìÓ¦ÆäËûÖÐ¶Ï£¬ÓÃ»§ÐèÔÚ½øÈë´¥ÃþÊ¡µçÄ£Ê½Ç°×ÔÐÐ¿ªÆôÆäËûÖÐ¶Ï£¬
  36          Èç¹ûÐèÒªÍË³öÊ¡µçÄ£Ê½£¬ÓÃ»§Ö»ÐèÒªÔÚÊ¡µçº¯ÊýÑ­»·ÄÚ¼ÓÈëÌõ¼þÅÐ¶Ï£¬Ìø³öÑ­»·¼´¿É¡£
  37          
  38          ±äÁ¿TS_SleepEnÊÇ¿ØÖÆ´¥ÃþÊ¡µçÄ£Ê½µÄ¿ª¹Ø£¬Èç¹ûÏ£Íû³ÌÐòÔÚÄ³Ð©Ìõ¼þÏÂ²»½øÈëÊ¡µçÄ£Ê½£¬Ö»ÐèÔÚ´ËÌõ¼þÏÂÉèÖÃTS_Sleep
             -En = 0£»
  39          
  40          
  41          ----------------------------------------------------------------------------------------------------------
             ---
C51 COMPILER V9.56.0.0   MAIN                                                              08/03/2020 17:20:28 PAGE 2   

  42          5.´¥ÃþÍâ¹ÒµçÈÝ(¼´TK_CAPÒý½ÅÁ¬½ÓµçÈÝ)·¶Î§£º6nF~50nF,½¨ÒéÖµ£º20nF£¨¼´203£©
  43          ----------------------------------------------------------------------------------------------------------
             ---
  44          6.´¥ÃþÒý½Å´®Áªµç×è·¶Î§£º0~5K£¬½¨ÒéÖµ£º1KÅ·Ä·£¬Èç¹ûÓÐ¿¹¶Ô½²»úµÈµç´Å¸ÉÈÅÒªÇó£¬ ´Ëµç×èÖÁÉÙ3KÒÔÉÏ¡£
  45          ********************************************************************************************************/
  46          unsigned char read_inner_trim(void)       
  47          {
  48   1        unsigned char value;
  49   1        FSCMD = 0x80; 
  50   1        PTSH = 0x00;        
  51   1        PTSL = 0x24;      
  52   1        FSCMD = 0x81;           
  53   1        value = FSDAT;
  54   1        FSCMD = 0;
  55   1        return value;
  56   1      }
  57          void SystemInit(void)
  58          {
  59   1      #ifdef LVD_RST_ENABLE
  60   1        LVDCON = 0xc1;  //ÉèÖÃLVD¸´Î»µçÑ¹Îª2V
  61   1      #endif
  62   1      #if (SYSCLK_SRC == PLL)
  63   1        Sys_Clk_Set_PLL(PLL_Multiple);  
  64   1      #endif
  65   1      #ifdef UART0_EN
                Uart0_Initial(UART0_BAUTRATE);
              #endif
  68   1      #ifdef UART1_EN
  69   1        Uart1_Initial(UART1_BAUTRATE);
  70   1      #endif
  71   1      
  72   1      #if (RTC_CLK_SELECT == IRCL)
  73   1      //¿´ÃÅ¹·Ê±ÖÓÔ´ÎªIRCL
  74   1        CKCON |= ILCKE;                                 //Ê¹ÄÜIRCL
  75   1        WDCON  = WDTS(WDTS_IRCL) | WDRE(WDRE_reset);    //ÉèÖÃ¿´ÃÅ¹·Ê±ÖÓÔ´ÎªILCKE£¬Ä£Ê½Îª¸´Î»Ä£Ê½
  76   1      #elif (RTC_CLK_SELECT == XOSCL) 
                CKCON |= XLCKE;
                while(!(CKCON & XLSTA));
                WDCON  = WDTS(WDTS_XOSCL) | WDRE(WDRE_reset);   //ÉèÖÃ¿´ÃÅ¹·Ê±ÖÓÔ´ÎªXOSCL£¬Ä£Ê½Îª¸´Î»Ä£Ê½
              #endif
  81   1        WDVTHH = 0;                                     //¿´ÃÅ¹·¸´Î»ãÐÖµ¸ß°ËÎ»ÉèÖÃ µ±Ç°ÖµÎª5s 
  82   1        WDVTHL = 75;                                    //¿´ÃÅ¹·¸´Î»ãÐÖµµÍ°ËÎ»ÉèÖÃ
  83   1        WDFLG = 0xA5; 
  84   1        
  85   1        
  86   1        ADCFGH = (ADCFGH&0xC0) | VTRIM(read_inner_trim());  //¼ÓÔØADCÄÚ²¿»ù×¼Ð£×¼Öµ
  87   1      }
  88          void main(void)
  89          {
  90   1        SystemInit();
  91   1      
  92   1        EA = 1;
  93   1      
  94   1        TS_init();  
  95   1        uart_printf("start\n");
  96   1        while(1)
  97   1        {   
  98   2      
  99   2          uart_printf("0\n");
 100   2          TS_Action();
 101   2      #if SUPPORT_WHEEL_SLIDER
                  if(WheelSliderPosition != -1)
C51 COMPILER V9.56.0.0   MAIN                                                              08/03/2020 17:20:28 PAGE 3   

                  {
                    //µ±WheelSliderPosition²»µÈÓÚ-1Ê±£¬ ±íÊ¾»¬Ìõ»òÔ²»·ÓÐ´¥ÃþÊÂ¼þ·¢Éú¡£WheelSliderPositionµÄÖµ±íÊ¾»¬Ìõ»òÔ²»·
             -µÄÎ»ÖÃ¡£
                  }
              #endif
 107   2      #if SUPPORT_KEY
 108   2      /*************************************************************************************************
 109   2      ±äÁ¿KeysFlagSNÊÇ´¥Ãþ¿â¶ÔÍâµÄÊý¾Ý½Ó¿Ú£¬KeysFlagSNµÄÃ¿Ò»Î»¶ÔÓ¦Ò»¸ö´¥Ãþ¼üµÄ×´Ì¬£¬Îª1±íÊ¾´¥Ãþ¼ü´¥·¢¡£¿É¶à¼üÍ¬Ê
             -±´¥·¢¡£
 110   2      *************************************************************************************************/
 111   2          if(KeysFlagSN != 0)
 112   2          {
 113   3            uart_printf("KeysFlagSN%d\n",KeysFlagSN);
 114   3            switch(KeysFlagSN)
 115   3            {
 116   4              case 0x0001:
 117   4                break;
 118   4              case 0x0002:
 119   4                break;
 120   4              case 0x0004:
 121   4                break;
 122   4              //......
 123   4              default:
 124   4                break;
 125   4            }
 126   3          }
 127   2      #if GENERATE_TS_KEY_EN
 128   2      /*************************************************************************************************
 129   2      ±äÁ¿TS_KeyÊÇ¸ù¾ÝKeysFlagSNµÃµ½µÄ°´¼üÐÅÏ¢£¬ÒÔÏÂÎª°´¼ü²úÉúµÄ¹ý³Ì£º
 130   2      |---------------------------------------------------------------------------------------------------------
             ---------------------------|
 131   2      | µ¥¼ü£ºÒÔK1ÎªÀý£¬K1°´¼ü²úÉúµÄÁ÷³ÌÈçÏÂËùÊ¾£º                                                                                        |
 132   2      |                                                                                                                                   |
 133   2      |           |---> K1|KEY_BREAK(¶Ì°´ËÉ¿ª)                                                                                            |
 134   2      | K1(°´ÏÂ)--|                                                                                                                       |
 135   2      |           |---> K1|KEY_LONG_START(³¤°´´óÔ¼1Ãë)---> K1|KEY_LONG(Ò»Ö±³¤°´£¬Ô¼Ã¿300ms²úÉúÒ»´Î³¤°´¼ü)---->K1|KEY
             -_LONG_BREAK(³¤°´ËÉ¿ª) |
 136   2      |                                                ^                                                  |                               |
 137   2      |                                                |                                                  |                               |
 138   2      |                                                |----------<-----------<------------<--------------|                               |
 139   2      |---------------------------------------------------------------------------------------------------------
             ---------------------------|
 140   2      
 141   2      |---------------------------------------------------------------------------------------------------------
             ---------------------------------------------------------------|
 142   2      |                                                                                                                                                                       |
 143   2      | ¸´ºÏ¼ü£ºÒÔK1(K1=0x0001),K2(K2=0x0002)ÎªÀý£¬ µ±K1£¬K2Í¬Ê±°´ÏÂÊ±£¬²úÉú°´¼üÎª(K1<<5)|K2£¬¼´0x22, ²úÉú°´¼üµÄ
             -Á÷³ÌÈçÏÂËùÊ¾£º                                                |
 144   2      |                                                                                                                                                                       |
 145   2      |                   |---> ((K1<<5)|K2)|KEY_BREAK(¶Ì°´ËÉ¿ª)                                                                                                              |
 146   2      | (K1<<5)|K2(°´ÏÂ)--|                                                                                                                                                   |
 147   2      |                   |---> ((K1<<5)|K2)|KEY_LONG_START(³¤°´´óÔ¼1Ãë)---> ((K1<<5)|K2)|KEY_LONG(Ò»Ö±³¤°´£¬Ô¼Ã¿300ms²úÉ
             -ú³¤°´¼ü)---->((K1<<5)|K2)|KEY_LONG_BREAK(³¤°´ËÉ¿ª)    |
 148   2      |                                                                  ^                                                         |                                          |
 149   2      |                                                                  |                                                         |                                          |
 150   2      |                                                                  |---------<-------------<----------------<----------------|                      
             -                    |
 151   2      |---------------------------------------------------------------------------------------------------------
             ---------------------------------------------------------------|
 152   2                                                                     
 153   2      ×¢Òâ£ºÓÉÓÚ¸´ºÏ¼ü°´ÏÂÊ±£¬Èí¼þ²»Ò»¶¨Í¬Ê±¼ì²âµ½Ë«¼ü£¬¶øÊÇÏÈ¼ì²âµ½µ¥¼ü°´ÏÂ£¬ÀýÈçÏÈ¼ì²âµ½K1£¬´ËÊ±»áÏÈ²úÉúK1¼ü£¬
             -µÈµ½¼ì²âµ½K2Ò²°´
C51 COMPILER V9.56.0.0   MAIN                                                              08/03/2020 17:20:28 PAGE 4   

 154   2      ÏÂÊ±£¬²Å»á²úÉú°´¼ü(K1<<5)|K2£¬¼ì²âµ½Ë«¼üºó£¬Èç¹ûË«¼üÒ»Ö±°´ÏÂ£¬»á²úÉú((K1<<5)|K2)|KEY_LONG_STARTºÍ((K1<<5)|
             -K2)|KEY_LONG£¬Èç¹û
 155   2      ÓÐÒ»¸ö¼üÏÈËÉÊÖ£¬»áÍ£Ö¹²úÉú°´¼ü£¬ µÈµ½Ë«¼ü¶¼ËÉ¿ªÊ±£¬²Å»á²úÉú((K1<<5)|K2)|KEY_BREAK(¶Ì°´ËÉ¿ª)»ò((K1<<5)|K2)|
             -KEY_LONG_BREAK(³¤°´ËÉ¿ª)
 156   2      *************************************************************************************************/
 157   2          if(TS_Key != 0)
 158   2          {
 159   3            switch(TS_Key)
 160   3            {
 161   4              //µ¥°´¼üÏûÏ¢
 162   4              case K1:                  //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢      
 163   4                break;
 164   4              case (K1|KEY_BREAK):      //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 165   4                break;
 166   4              case (K1|KEY_LONG_START): //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 167   4                break;
 168   4              case (K1|KEY_LONG):       //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 169   4                break;
 170   4              case (K1|KEY_LONG_BREAK): //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 171   4                break;
 172   4        //µ¥°´¼üÏûÏ¢
 173   4              case K2:                  //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 174   4                break;
 175   4              case (K2|KEY_BREAK):      //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 176   4                break;
 177   4              case (K2|KEY_LONG_START): //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 178   4                break;
 179   4              case (K2|KEY_LONG):       //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 180   4                break;
 181   4              case (K2|KEY_LONG_BREAK): //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 182   4                break;
 183   4      //µ¥°´¼üÏûÏ¢
 184   4              case K3:                  //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 185   4                break;
 186   4              case (K3|KEY_BREAK):      //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 187   4                break;
 188   4              case (K3|KEY_LONG_START): //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 189   4                break;
 190   4              case (K3|KEY_LONG):       //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 191   4                break;
 192   4              case (K3|KEY_LONG_BREAK): //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 193   4                break;
 194   4      //µ¥°´¼üÏûÏ¢
 195   4              case K4:                  //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 196   4                break;
 197   4              case (K4|KEY_BREAK):      //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 198   4                break;
 199   4              case (K4|KEY_LONG_START): //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 200   4                break;
 201   4              case (K4|KEY_LONG):       //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 202   4                break;
 203   4              case (K4|KEY_LONG_BREAK): //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 204   4                break;
 205   4      //µ¥°´¼üÏûÏ¢
 206   4              case K5:                  //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 207   4                break;
 208   4              case (K5|KEY_BREAK):      //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 209   4                break;
 210   4              case (K5|KEY_LONG_START): //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 211   4                break;
 212   4              case (K5|KEY_LONG):       //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 213   4                break;
C51 COMPILER V9.56.0.0   MAIN                                                              08/03/2020 17:20:28 PAGE 5   

 214   4              case (K5|KEY_LONG_BREAK): //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 215   4                break;
 216   4      //µ¥°´¼üÏûÏ¢
 217   4              case K6:                  //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 218   4                break;
 219   4              case (K6|KEY_BREAK):      //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 220   4                break;
 221   4              case (K6|KEY_LONG_START): //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 222   4                break;
 223   4              case (K6|KEY_LONG):       //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 224   4                break;
 225   4              case (K6|KEY_LONG_BREAK): //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 226   4                break;
 227   4      #if GENERATE_DOUBLE_KEY_EN
                //¸´ºÏ¼üÏûÏ¢
                      case (K1<<5)|K2:                    //K1ºÍK2Í¬Ê±°´ÏÂÊ±²úÉúµÄ°´¼üÏûÏ¢
              
                        break;
                      case ((K1<<5)|K2)|KEY_BREAK:        //K1ºÍK2¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
              
                        break;
                      case ((K1<<5)|K2)|KEY_LONG_START:   //K1ºÍK2³¤°´¿ªÊ¼²úÉúµÄ°´¼üÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
                        break;
                      case ((K1<<5)|K2)|KEY_LONG:         //K1ºÍK2³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
                        break;
                      case ((K1<<5)|K2)|KEY_LONG_BREAK:   //K1ºÍK2³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
                        break;
              #endif
 242   4            }
 243   3          }
 244   2      #endif
 245   2      #endif
 246   2        }
 247   1      }
 248          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    130    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
